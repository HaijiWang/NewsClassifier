<%@ page language="java" 
	contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>

<%@ page import="java.io.IOException"
		import="org.apache.solr.client.solrj.SolrQuery"
		import="org.apache.solr.client.solrj.SolrQuery.ORDER"
		import="org.apache.solr.client.solrj.SolrServerException"
		import="org.apache.solr.client.solrj.impl.BinaryRequestWriter"
		import="org.apache.solr.client.solrj.impl.HttpSolrServer"
		import="org.apache.solr.client.solrj.impl.XMLResponseParser"
		import="org.apache.solr.client.solrj.response.QueryResponse"
		import="org.apache.solr.common.SolrDocument" 
		import="solr_classification.com.SolrConnection" %>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<body>

	<%!
	private static final String SOLR_URL = "http://58.213.107.34/solr/";
	%>
	<%!
	private static QueryResponse getContent(String solrUrl) throws SolrServerException, IOException{
		HttpSolrServer server = new HttpSolrServer(solrUrl);
		
		// optional settings: 
		server.setMaxRetries(1);
		server.setMaxRetries(1); // defaults to 0. > 1 not recommended.
		server.setConnectionTimeout(5000); // 5 seconds to establish TCP
		server.setParser(new XMLResponseParser());
		server.setSoTimeout(1000); // socket read timeout
		server.setDefaultMaxConnectionsPerHost(100);
		server.setMaxTotalConnections(100);
		server.setFollowRedirects(false); // defaults to false
		
		// allowCompression defaults to false.
		// Server side must support gzip or deflate for this to have any effect.
		server.setAllowCompression(true);

		//server.setRequestWriter(new BinaryRequestWriter());
		SolrQuery query = new SolrQuery();
		query.setQuery("content:医");
		query.setFields("id","content");
		//query.setSort("price", ORDER.asc);
		query.setStart(0);
		query.setRows(1);
		//query.set("wt","xml");
		//query.setRequestHandler("/select");
		QueryResponse my_response = server.query( query );
		
		// Get results
		System.out.println("Found:" + my_response.getResults().getNumFound());
		
		return my_response;
	}
	%>
	
		
		
	<%
		try {
			QueryResponse solr_response = getContent(SOLR_URL);
			int iRow = 1;
			for (SolrDocument doc : solr_response.getResults()) {
				System.out.println("----------" + iRow + "------------");
				System.out.println("id: " + doc.getFieldValue("id").toString());
				System.out.println("content: " + doc.getFieldValue("content").toString());
				
				out.println("<table border=2>");
				out.println("<tr><th>");
				out.println("id: " + doc.getFieldValue("id").toString());
				out.println("</th><th>");
				out.println("content: " + doc.getFieldValue("content").toString());
				out.println("</th></tr>");
				out.println("</table>");
				out.println();
				iRow++;
			}
		} catch(Exception e){
			System.out.println(e);
		}
	%>
	
	<form action="main2.jsp" method="GET" target="_blank">
	<input type="checkbox" name="name_医" checked="checked" /> 医
	<input type="checkbox" name="name_cars"  /> cars
	<input type="checkbox" name="name_ecco"  /> ecco
	<input type="submit" value="submit" />
	</form>
		
		
	
	



  
</body>
</html>